<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Notes</title>
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="icon" href="/favicon-16x16.png" sizes="16x16" type="image/png">
    <link rel="icon" href="/favicon-32x32.png" sizes="32x32" type="image/png">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <script>
        (() => {
            const THEME_KEY = 'theme';
            let stored;
            try {
                stored = localStorage.getItem(THEME_KEY);
            } catch (e) {
                stored = null;
            }
            const theme = stored || 'light';
            document.documentElement.setAttribute('data-bs-theme', theme);
        })();
    </script>
    <link rel="stylesheet" href="/webjars/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/webjars/font-awesome/css/all.min.css">
</head>
<body class="bg-body-tertiary">
<nav class="navbar navbar-expand-lg bg-body border-bottom shadow-sm">
    <div class="container d-flex align-items-center gap-3 flex-wrap justify-content-between">
        <div class="d-flex align-items-center gap-2">
            <a class="navbar-brand d-flex align-items-center gap-2 mb-0" href="#">
                <img src="/favicon.svg" alt="Notes logo" width="28" height="28">
                <span>Notes</span>
            </a>
        </div>
        <div class="d-flex align-items-center gap-2 ms-auto flex-nowrap" style="max-width: 540px;">
            <div class="input-group input-group-sm flex-grow-1" style="min-width: 260px;">
                <input type="text" class="form-control" placeholder="Search notes" id="searchInput">
                <button class="btn btn-outline-secondary" type="button" id="searchClear" aria-label="Clear search">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <button class="btn btn-outline-secondary btn-sm d-inline-flex align-items-center gap-2 flex-shrink-0" type="button" id="themeToggle">
                <i class="fa-solid fa-moon" id="themeToggleIcon"></i>
                <span id="themeToggleLabel">Dark</span>
            </button>
            <div class="dropdown">
                <button class="btn btn-primary btn-sm d-inline-flex align-items-center gap-2 flex-shrink-0 dropdown-toggle d-none" type="button" id="authBtn" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="fa-solid fa-user"></i>
                    <span id="authBtnLabel"></span>
                </button>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="authBtn" id="authMenu">
                    <li class="dropdown-header text-muted small d-none" id="authUserLabel"></li>
                    <li><hr class="dropdown-divider d-none" id="signOutDivider"></li>
                    <li><button class="dropdown-item d-flex align-items-center gap-2 d-none" type="button" id="signOutBtn"><i class="fa-solid fa-arrow-right-from-bracket"></i><span>Sign out</span></button></li>
                </ul>
            </div>
        </div>
    </div>
    </nav>

<header class="py-4 mb-4 shadow-sm bg-body-tertiary">
    <div class="container d-flex flex-column flex-md-row align-items-md-center justify-content-between">
        <div>
            <h1 class="h4 mb-1 text-body">Notes</h1>
            <p class="mb-0 text-muted">Create, edit, delete — audit-ready. Sign in to get a JWT; audit metadata uses your user.</p>
        </div>
        <div class="mt-3 mt-md-0 d-flex gap-2 flex-wrap">
            <span class="badge bg-primary-subtle text-primary">JPA Auditing</span>
            <span class="badge bg-primary-subtle text-primary">Liquibase</span>
            <span class="badge bg-primary-subtle text-primary">Springdoc</span>
        </div>
    </div>
</header>

<main class="bg-body-tertiary">
<div class="container pb-5">
    <div id="toastContainer" class="position-fixed top-0 end-0 p-3" style="z-index: 1080;"></div>

    <div class="row g-4 align-items-start">
        <div class="col-lg-3 order-1 order-lg-2 d-flex flex-column gap-2">
            <button class="btn btn-primary shadow-sm px-3 py-2 w-100" type="button" id="addNoteBtn">
                <i class="fa-solid fa-plus"></i> New Note
            </button>
        </div>

        <div class="col-lg-9 order-2 order-lg-1">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="h5 mb-0 d-flex align-items-center gap-2">
                    <i class="fa-solid fa-layer-group text-primary"></i>
                    <span>All Notes</span>
                </h2>
                <span class="text-muted small" id="totalLabel">Total: 0</span>
            </div>

            <div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
                <ul class="nav nav-tabs nav-tabs-sm shadow-sm" id="viewTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active d-inline-flex align-items-center gap-2" id="activeViewTab" type="button" role="tab" aria-selected="true">
                            <i class="fa-solid fa-layer-group"></i><span>Active</span>
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link d-inline-flex align-items-center gap-2" id="trashViewTab" type="button" role="tab" aria-selected="false">
                            <i class="fa-solid fa-trash-can"></i><span>Trash</span>
                        </button>
                    </li>
                </ul>
                <div class="text-muted small" id="pageInfo" hidden>Page 1 of 1</div>
            </div>

            <div class="card shadow-sm border-0 mb-3">
                <div class="card-body">
                    <div class="d-flex flex-wrap align-items-start gap-3">
                        <div class="flex-grow-1" style="min-width: 320px;">
                            <label class="form-label small text-muted mb-1" for="filterTagsInput">Filter by tags</label>
                            <div class="form-control p-2" id="filterTagsContainer">
                                <div id="filterTagsList" class="d-flex flex-wrap gap-2 mb-2"></div>
                                <input id="filterTagsInput" type="text" class="form-control form-control-sm border-0 shadow-none p-0" list="filterTagsSuggestions" placeholder="Type to search tags, press Enter or comma">
                                <datalist id="filterTagsSuggestions"></datalist>
                            </div>
                            <div class="invalid-feedback d-none" id="filterTagsError"></div>
                        </div>
                        <div class="d-flex flex-column gap-2 flex-shrink-0" style="min-width: 180px;">
                            <label class="form-label small text-muted mb-1" for="filterColor">Color</label>
                            <div class="d-flex align-items-center gap-2">
                                <input id="filterColor" type="color" class="form-control form-control-color" value="#2563eb" aria-label="Pick color filter" style="width: 48px; height: 38px;">
                                <button class="btn btn-outline-secondary btn-sm flex-grow-1" type="button" id="clearColorFilter">
                                    <i class="fa-solid fa-xmark"></i> Clear
                                </button>
                            </div>
                        </div>
                        <div class="d-flex flex-column gap-2 flex-shrink-0" style="min-width: 160px;">
                            <label class="form-label small text-muted mb-1" for="filterPinned">Pinned</label>
                            <select id="filterPinned" class="form-select form-select-sm">
                                <option value="">All</option>
                                <option value="true">Pinned</option>
                                <option value="false">Unpinned</option>
                            </select>
                        </div>
                    </div>
                    <div class="d-flex gap-2 flex-wrap mt-3">
                        <button class="btn btn-outline-secondary btn-sm" type="button" id="resetFilters">
                            <i class="fa-solid fa-rotate-left"></i> Reset
                        </button>
                        <button class="btn btn-primary btn-sm" type="button" id="applyFilters">
                            <i class="fa-solid fa-filter"></i> Apply
                        </button>
                    </div>
                </div>
            </div>

        <div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2" id="controlsRow">
            <div class="d-flex flex-wrap align-items-center gap-3">
                <div class="d-flex align-items-center gap-2">
                    <label class="text-muted small mb-0" for="pageSize">Page size</label>
                    <select class="form-select form-select-sm w-auto" id="pageSize">
                            <option value="5">5</option>
                            <option value="10" selected>10</option>
                            <option value="25">25</option>
                        </select>
                    </div>
                    <div class="d-flex align-items-center gap-2">
                        <label class="text-muted small mb-0" for="sortSelect">Sort</label>
                        <select class="form-select form-select-sm w-auto" id="sortSelect">
                            <option value="createdDate,desc" selected>Created (newest)</option>
                            <option value="createdDate,asc">Created (oldest)</option>
                            <option value="lastModifiedDate,desc">Updated (newest)</option>
                            <option value="lastModifiedDate,asc">Updated (oldest)</option>
                            <option value="title,asc">Title A-Z</option>
                            <option value="title,desc">Title Z-A</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-outline-danger btn-sm d-inline-flex align-items-center gap-2 d-none" type="button" id="emptyTrashBtn" hidden>
                    <span class="spinner-border spinner-border-sm d-none" id="emptyTrashSpinner" role="status" aria-hidden="true"></span>
                    <i class="fa-solid fa-trash"></i><span id="emptyTrashLabel">Empty Trash</span>
                </button>
            </div>

            <div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2" id="bulkRow">
                <div class="form-check mb-0">
                    <input class="form-check-input" type="checkbox" value="" id="selectAllCheckbox">
                    <label class="form-check-label text-muted small" for="selectAllCheckbox">
                        Select all on page
                    </label>
                </div>
                <div class="d-flex flex-wrap gap-2 align-items-center" id="bulkActions">
                    <span class="text-muted small d-none" id="selectedCount">Selected: 0</span>
                    <button class="btn btn-outline-danger btn-sm d-inline-flex align-items-center gap-1" type="button" id="bulkDeleteBtn" disabled>
                        <i class="fa-solid fa-trash"></i> Delete
                    </button>
                    <button class="btn btn-outline-success btn-sm d-inline-flex align-items-center gap-1 d-none" type="button" id="bulkRestoreBtn" disabled>
                        <i class="fa-solid fa-rotate-left"></i> Restore
                    </button>
                    <button class="btn btn-outline-danger btn-sm d-inline-flex align-items-center gap-1 d-none" type="button" id="bulkDeleteForeverBtn" disabled>
                        <i class="fa-solid fa-trash"></i> Delete permanently
                    </button>
                </div>
            </div>

            <div class="row g-3" id="noteGrid">
                <div class="col-12 text-center text-muted py-3">Loading...</div>
            </div>

            <div class="d-flex justify-content-center mt-3" id="pager" hidden>
                <div class="d-flex align-items-center gap-3">
                    <ul class="pagination mb-0" id="pagination"></ul>
                </div>
            </div>
        </div>

    </div>
</div>
</main>

<!-- Note Modal -->
<div class="modal fade" id="noteModal" tabindex="-1" aria-labelledby="noteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="noteModalLabel">New Note</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="formAlert" class="alert alert-danger d-none"></div>
                <form id="noteForm" novalidate>
                    <div class="mb-3">
                        <label class="form-label" for="title">Title</label>
                        <input id="title" name="title" type="text" class="form-control" placeholder="Enter a concise title" required minlength="3" maxlength="255">
                        <div class="invalid-feedback" data-error-type="title-required">This field is required.</div>
                        <div class="invalid-feedback d-none" data-error-type="title-size">Size must be between 3 and 255 characters.</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="content">Content</label>
                        <textarea id="content" name="content" rows="4" class="form-control" placeholder="Describe your note" required minlength="10" maxlength="1024"></textarea>
                        <div class="invalid-feedback" data-error-type="content-required">This field is required.</div>
                        <div class="invalid-feedback d-none" data-error-type="content-size">Size must be between 10 and 1024 characters.</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="color">Color</label>
                        <input id="color" name="color" type="color" class="form-control form-control-color" value="#2563eb" aria-label="Pick a color">
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="tagsInput">Tags</label>
                        <div class="form-control p-2" id="tagsContainer">
                            <div id="tagsList" class="d-flex flex-wrap gap-2 mb-2"></div>
                            <div class="d-flex align-items-center mt-1">
                                <input id="tagsInput" type="text" class="form-control border-0 shadow-none p-0 w-100" placeholder="Type and press Enter or comma" list="tagSuggestions">
                            </div>
                            <datalist id="tagSuggestions"></datalist>
                        </div>
                        <!-- helper text removed per request -->
                        <div class="invalid-feedback d-none" id="tagsLimitMessage">Up to 5 tags allowed.</div>
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="pinned" name="pinned">
                        <label class="form-check-label text-body" for="pinned">Pin this note</label>
                    </div>
                    <div class="d-flex justify-content-end">
                        <button class="btn btn-primary d-inline-flex align-items-center gap-2" type="submit">
                            <span class="spinner-border spinner-border-sm d-none" id="noteSubmitSpinner" role="status" aria-hidden="true"></span>
                            <i class="fa-solid fa-save"></i><span id="noteSubmitLabel">Save</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Delete Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Delete Note</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="mb-3">Are you sure you want to delete this note?</p>
                <div class="d-flex justify-content-end gap-2">
                    <button type="button" class="btn btn-outline-secondary d-inline-flex align-items-center gap-2" data-bs-dismiss="modal">
                        <i class="fa-solid fa-xmark"></i> Cancel
                    </button>
                    <button type="button" class="btn btn-danger d-inline-flex align-items-center gap-2" id="confirmDeleteBtn">
                        <span class="spinner-border spinner-border-sm d-none" id="deleteSpinner" role="status" aria-hidden="true"></span>
                        <i class="fa-solid fa-trash"></i><span id="deleteLabel">Delete</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Empty Trash Modal -->
<div class="modal fade" id="emptyTrashModal" tabindex="-1" aria-labelledby="emptyTrashModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="emptyTrashModalLabel">Empty Trash</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="mb-3">This will permanently delete all items in Trash. Continue?</p>
                <div class="d-flex justify-content-end gap-2">
                    <button type="button" class="btn btn-outline-secondary d-inline-flex align-items-center gap-2" data-bs-dismiss="modal">
                        <i class="fa-solid fa-xmark"></i> Cancel
                    </button>
                    <button type="button" class="btn btn-danger d-inline-flex align-items-center gap-2" id="confirmEmptyTrashBtn">
                        <span class="spinner-border spinner-border-sm d-none" id="emptyTrashConfirmSpinner" role="status" aria-hidden="true"></span>
                        <i class="fa-solid fa-trash"></i><span id="emptyTrashConfirmLabel">Empty Trash</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Permanent Delete Modal -->
<div class="modal fade" id="deleteForeverModal" tabindex="-1" aria-labelledby="deleteForeverModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteForeverModalLabel">Delete Permanently</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="mb-3">This action cannot be undone. Delete this note permanently?</p>
                <div class="d-flex justify-content-end gap-2">
                    <button type="button" class="btn btn-outline-secondary d-inline-flex align-items-center gap-2" data-bs-dismiss="modal">
                        <i class="fa-solid fa-xmark"></i> Cancel
                    </button>
                    <button type="button" class="btn btn-danger d-inline-flex align-items-center gap-2" id="confirmDeleteForeverBtn">
                        <span class="spinner-border spinner-border-sm d-none" id="deleteForeverSpinner" role="status" aria-hidden="true"></span>
                        <i class="fa-solid fa-trash"></i><span id="deleteForeverLabel">Delete</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bulk Action Modal -->
<div class="modal fade" id="bulkModal" tabindex="-1" aria-labelledby="bulkModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="bulkModalLabel">Confirm bulk action</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="mb-3" id="bulkModalMessage">Apply action to selected items?</p>
                <div class="d-flex justify-content-end gap-2">
                    <button type="button" class="btn btn-outline-secondary d-inline-flex align-items-center gap-2" data-bs-dismiss="modal">
                        <i class="fa-solid fa-xmark"></i> Cancel
                    </button>
                    <button type="button" class="btn btn-danger d-inline-flex align-items-center gap-2" id="confirmBulkBtn">
                        <span class="spinner-border spinner-border-sm d-none" id="bulkSpinner" role="status" aria-hidden="true"></span>
                        <i class="fa-solid fa-check"></i><span id="bulkConfirmLabel">Confirm</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Revision History Modal -->
<div class="modal fade" id="revisionModal" tabindex="-1" aria-labelledby="revisionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title d-flex align-items-center gap-2" id="revisionModalLabel">
                    <i class="fa-solid fa-clock-rotate-left text-primary"></i>
                    <span id="revisionModalTitle">Revisions</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="revisionModalBody">
                <div id="revisionError" class="alert alert-danger d-none"></div>
                <div class="d-flex justify-content-center py-3" id="revisionSpinner">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
                <div class="list-group" id="revisionList" style="overflow-y: auto; overflow-x: hidden;"></div>
                <div class="text-muted small mt-2">
                    <i class="fa-regular fa-circle-question me-1"></i>
                    Selecting “Restore” will overwrite the current note with the chosen snapshot.
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Change Owner Modal -->
<div class="modal fade" id="ownerModal" tabindex="-1" aria-labelledby="ownerNoteTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <form id="ownerForm" novalidate>
                <div class="modal-header">
                    <h5 class="modal-title d-flex align-items-center gap-2" id="ownerNoteTitle">
                        <i class="fa-solid fa-user-gear text-primary"></i>
                        <span id="ownerNoteTitleText">Change owner</span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="ownerAlert" class="alert alert-danger d-none"></div>
                    <div id="ownerCurrentLabel" class="text-muted small mb-2 d-none"></div>
                    <label class="form-label" for="ownerInput">New owner</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="ownerInput" name="owner" placeholder="Search username" autocomplete="off" required>
                    </div>
                    <div class="list-group mt-2" id="ownerSuggestions" style="overflow-y: auto; overflow-x: hidden;"></div>
                    <div class="d-grid mt-2">
                        <button type="button" class="btn btn-outline-secondary btn-sm d-none d-flex align-items-center justify-content-center gap-2" id="ownerLoadMore">
                            <span class="spinner-border spinner-border-sm d-none" data-owner-load-more-spinner="true" role="status" aria-hidden="true"></span>
                            <span>Load more</span>
                        </button>
                    </div>
                    <div class="form-text text-muted">Type to search and pick a user to set as owner.</div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary d-inline-flex align-items-center gap-2" data-bs-dismiss="modal">
                        <i class="fa-solid fa-xmark"></i> Cancel
                    </button>
                    <button type="submit" class="btn btn-primary d-inline-flex align-items-center gap-2" id="ownerSubmit" disabled>
                        <span class="spinner-border spinner-border-sm d-none" id="ownerSubmitSpinner" role="status" aria-hidden="true"></span>
                        <i class="fa-solid fa-user-check"></i> <span>Change owner</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>


<footer class="bg-body border-top py-3 mt-5">
    <div class="container d-flex justify-content-center gap-3 text-muted small">
        <span>&copy; 2025 Notes</span>
        <span>Spring Boot</span>
    </div>
</footer>

<script src="/webjars/bootstrap/js/bootstrap.bundle.min.js"></script>
<script type="module" src="/js/main.js"></script>
</body>
</html>
